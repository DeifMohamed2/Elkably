<!DOCTYPE html>
<html lang="ar" dir="rtl">

    <%- include("./partials/head.ejs") %>

<style>
:root {
    --dark-bg: #121212;
    --dark-card-bg: #1e1e1e;
    --dark-text: #e0e0e0;
    --dark-border: #333;
    --dark-input-bg: #2d2d2d;
    --dark-hover: #2c2c2c;
    --dark-primary: #3a7bd5;
    --dark-secondary: #4d4d4d;
    --dark-success: #28a745;
    --dark-danger: #dc3545;
    --dark-warning: #ffc107;
    --dark-info: #17a2b8;
}

body {
    background-color: var(--dark-bg);
    color: var(--dark-text);
}

.container-fluid {
    background-color: var(--dark-bg);
}

.card {
    background-color: var(--dark-card-bg);
    border-color: var(--dark-border);
}

.card-header {
    background-color: var(--dark-secondary);
    border-color: var(--dark-border);
}

.modal-content {
    background-color: var(--dark-card-bg);
    border-color: var(--dark-border);
}

.modal-header, .modal-footer {
    background-color: var(--dark-secondary);
    border-color: var(--dark-border);
}

.list-group-item {
    background-color: var(--dark-card-bg);
    border-color: var(--dark-border);
    color: var(--dark-text);
}

.form-control, select, input, .modal-input, .Grade {
    background-color: var(--dark-input-bg);
    border-color: var(--dark-border);
    color: var(--dark-text);
}

.form-control:focus, select:focus, input:focus {
    background-color: var(--dark-input-bg);
    color: var(--dark-text);
    border-color: var(--dark-primary);
    box-shadow: 0 0 0 0.2rem rgba(58, 123, 213, 0.25);
}

.btn-primary {
    background-color: var(--dark-primary);
    border-color: var(--dark-primary);
}

.btn-secondary {
    background-color: var(--dark-secondary);
    border-color: var(--dark-secondary);
}

.btn-danger {
    background-color: var(--dark-danger);
    border-color: var(--dark-danger);
}

.btn-outline-warning {
    color: var(--dark-warning);
    border-color: var(--dark-warning);
}

.btn-outline-warning:hover {
    background-color: var(--dark-warning);
    color: var(--dark-bg);
}

.btn-outline-primary {
    color: var(--dark-primary);
    border-color: var(--dark-primary);
}

.btn-outline-primary:hover {
    background-color: var(--dark-primary);
    color: var(--dark-text);
}

.btn-outline-danger {
    color: var(--dark-danger);
    border-color: var(--dark-danger);
}

.btn-outline-danger:hover {
    background-color: var(--dark-danger);
    color: var(--dark-text);
}

table {
    color: var(--dark-text);
}

table thead th {
    background-color: var(--dark-secondary);
    color: var(--dark-text);
}

table tbody tr {
    background-color: var(--dark-card-bg);
}

table tbody tr:nth-child(odd) {
    background-color: var(--dark-bg);
}

table tbody tr:hover {
    background-color: var(--dark-hover);
}

.pagination button, .paginationBtns {
    background-color: var(--dark-secondary);
    color: var(--dark-text);
    border-color: var(--dark-border);
}

.pagination button:hover, .paginationBtns:hover {
    background-color: var(--dark-primary);
}

.group {
    display: flex;
    flex-direction: column; /* Stack elements vertically */
    gap: 10px; /* Add some space between elements */
    max-width: 300px; /* Set a maximum width to keep it contained */
}

.group label, .group select {
    width: 100%; /* Make labels and selects take up the full width */
}

.spinner {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: 9px solid;
    border-color: #333;
    border-right-color: var(--dark-primary);
    animation: spinner-d3wgkg 1s infinite linear;
}

@keyframes spinner-d3wgkg {
    to {
      transform: rotate(1turn);
    }
}

/* Dark mode for advanced search card */
#advancedSearchForm label {
    color: var(--dark-text);
}

#studentDetailsContainer .list-group-item {
    display: flex;
    justify-content: space-between;
    background-color: var(--dark-card-bg);
}

#studentDetailsContainer .list-group-item span {
    color: var(--dark-text);
}

#studentDetailsContainer .list-group-item strong {
    color: var(--dark-primary);
}

.bg-success {
    background-color: var(--dark-success) !important;
}

.bg-primary {
    background-color: var(--dark-primary) !important;
}

.close-modal {
    color: var(--dark-text);
}

</style>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-2" >
                <%- include("./partials/nav.ejs") %>
            </div>
            <!--------------------END ASIDE  ------------------>
   <!-- Modal -->

                
   <div class="modal fade show" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="exampleModalLabel"> Update Data</h2>
                <i class="fa-solid fa-xmark close-modal" data-bs-dismiss="modal" aria-label="Close"></i>
            </div>
            <form  id="formModalDataUpdate">

              <div class="spinner mx-auto" id="spinner"></div>
              <div class="modal-body">


                      <label for="ModalUserName">اسم الطالب : </label> 
                      <input type="text" id="ModalUserName" class="modal-input" name="Username" value=""> <br>
                      
                  
                      <label for="ModalUserphone">رقم هاتف الطالب : </label> 
                      <input type="tel" id="ModalUserphone" class="modal-input"name="phone" value=""> <br>
                      
      

                      <label for="ModalParentUserphone">رقم هاتف ولي امر الطالب : </label> 
                      <input type="tel" id="ModalParentUserphone" class="modal-input" name="parentPhone" value=""> <br>
                      
                      <label for="ModalUserAmount">Amount : </label>
                      <input type="tel" id="ModalUserAmount" class="modal-input" name="balance" value=""> <br>
              
                      <label for="amountRemaining">Amount Remaining : </label>
                      <input type="tel" id="amountRemaining" class="modal-input" name="amountRemaining" value=""> <br>

                      <label for="absences">Absences : </label>
                      <input type="number" id="absences" class="modal-input" name="absences" value=""> <br>

                  <label for="GradeLevel">Grade Level:</label>
                    <select name="GradeLevel" id="GradeLevel" class="modal-input Grade w-75" required>
                      <option value="10" >Grade 10</option>
                      <option value="11" >Grade 11</option>
                      <option value="12" >Grade 12</option>
                    </select>

                  <label for="attendingType">Attending Type:</label>
                  <select name="attendingType" id="attendingType" class="modal-input Grade w-75" required>
                    <option value="HomeSchooling" >Home Schooling</option>
                    <option value="Attending" >Attending</option>
                  </select>

                  <label for="bookTaken"> Book Taken </label>
                  <select name="bookTaken" id="bookTaken" class="modal-input Grade w-75" required>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                  </select>

                    <label for="ModalSchoolName">School Name :</label> 
                    <input type="text" id="schoolName" class="modal-input" name="schoolName" value=""> <br>
                    <input type="text" id="StudentID" class="d-none" value="">
                    <!-- <button type="button" class="btn btn-outline-primary" id="transferStudent">نقل الطالب الي</button>

                    <div class="group d-none" id="selectionGroup">
                      
                          <label for="centerName">Center Name</label>
                          <select name="centerName" id="centerNameToUpdate" class="Grade"  >
                              <option value="">Center Name</option>
                              <option value="GTA">GTA</option>
                              <option value="tagmo3">Tagmo3</option>
                          </select>

                          <label for="Grade">Grade</label>
                          <select name="Grade" id="GradeToUpdate" class="Grade" >
                              <option value="">Grade</option>
                          </select>

                          <label for="gradeType">Grade Type</label>
                          <select name="gradeType" id="gradeTypeToUpdate" class="Grade" >
                              <option value="">Grade Type</option>
                          </select>

                          <label for="groupTime">Group Time</label>
                          <select name="groupTime" id="groupTimeToUpdate" class="Grade" >
                              <option value="">Group Time</option>
                          </select>


                    </div> -->

              </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" >Close</button>
                <button type="submit"  class="btn btn-primary" data-bs-dismiss="modal">Update </button>
            </div>

        </form>
        </div>
    </div>
    </div>


    <div class="modal fade show" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel2" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" id="exampleModalLabel2"> مسح طالب</h2>
                    <i class="fa-solid fa-xmark close-modal" data-bs-dismiss="modal" aria-label="Close"></i>
                </div>
                <form id="deleteForm"  method="post">
    
                <div class="modal-body">
                  <h2>  هل تريد مسح الطالب نهائياً ؟</h2>
                  
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" window.location.herf="/teacher/studentsRequests">Close</button>
                    <button type="submit"  class="btn btn-primary" >Yes </button>
                </div>
            </form>
            </div>
        </div>
        </div>

<!--  END Modal -->
            <div class="col-lg-10 ">
                <main>
                    <div class="row">
                        <div class="col-md-8">
                            <form action="/teacher/studentsRequests" method="get">

                                 <select name="centerName" class="Grade" id="centerName" value="" required>
                                        <option value=""> اختر السنتر </option>
                                        <option value="GTA">GTA</option>
                                        <option value="tagmo3">Tagmo3</option>
                                        <option value="Online">Online</option>
                                    </select>
                                    <select name="Grade" id="Grade" class="Grade" value="" required>
                                            <option value=""> اختر الصف </option>
                                     
                                    </select>

                                    <select name="gradeType"  class="Grade"  id="gradeType" value="" required>
                                        <option value=""> Type</option>
                                    </select>


                                    <select name="groupTime" class="Grade" id="groupTime" value="" required>
                                        <option value=""> Group Time </option>
                                    </select>

                                    <select name="attendingType" class="Grade" id="attendingType" value="">
                                        <option value=""> Attending Type </option>
                                        <option value="HomeSchooling">Home Schooling</option>
                                        <option value="Attending">Attending</option>
                                    </select>

                                    <select name="GradeLevel" class="Grade" id="GradeLevel" value="">
                                      <option value=""> Grade Level</option>
                                      <option value="10">Grade 10</option>
                                      <option value="11">Grade 11</option>
                                      <option value="12">Grade 12</option>
                                    </select>

                                  <button class="btn btn-outline-warning me-5 mt-4" >Get Data</button>
                     
                            </form>
                        </div>
                    </div>
                    
                    <!-- Advanced Search Card -->
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">بحث متقدم عن طالب</h5>
                                </div>
                                <div class="card-body">
                                    <form id="advancedSearchForm">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="studentCode" class="form-label">كود الطالب</label>
                                                    <input type="text" class="form-control" id="studentCode" placeholder="أدخل كود الطالب">
                                                </div>
                                            </div>
                                            <div class="col-md-6 d-flex align-items-end">
                                                <button type="submit" class="btn btn-primary">بحث</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Student Details Card (Hidden by default) -->
                    <div class="row mt-3" id="studentDetailsContainer" style="display: none;">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0">بيانات الطالب</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <ul class="list-group">
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>اسم الطالب:</span>
                                                    <strong id="detailUsername"></strong>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>كود الطالب:</span>
                                                    <strong id="detailCode"></strong>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>رقم هاتف الطالب:</span>
                                                    <strong id="detailPhone"></strong>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>رقم هاتف ولي الأمر:</span>
                                                    <strong id="detailParentPhone"></strong>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6">
                                            <ul class="list-group">
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>السنتر:</span>
                                                    <strong id="detailCenter"></strong>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>الصف:</span>
                                                    <strong id="detailGrade"></strong>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>النوع:</span>
                                                    <strong id="detailGradeType"></strong>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>المجموعة:</span>
                                                    <strong id="detailGroupTime"></strong>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <ul class="list-group">
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>المبلغ:</span>
                                                    <strong id="detailBalance"></strong>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>المبلغ المتبقي:</span>
                                                    <strong id="detailAmountRemaining"></strong>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6">
                                            <ul class="list-group">
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>عدد مرات الغياب:</span>
                                                    <strong id="detailAbsences"></strong>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>نوع الحضور:</span>
                                                    <strong id="detailAttendingType"></strong>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-12 text-center">
                                            <button type="button" class="btn btn-primary me-2" onclick="editAdvancedStudent()">
                                                تعديل البيانات <i class="fa-solid fa-pen-to-square"></i>
                                            </button>
                                            <button type="button" class="btn btn-danger" onclick="deleteAdvancedStudent()">
                                                حذف الطالب <i class="fa-solid fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <table id="convetToexcel" style="display: none;">
                        
                    </table>
                    <div class="row">
                        <div class="col-md-12  col-sm-12">
                            <div class="student-table">
                                <form action="/teacher/searchForUser" method="post">

                                    <div class="row" style="margin-bottom: 0 !important;">
                                        <div class="col-md-4">   
                                            <select name="searchBy" id="searchBy"  class="Grade" style="margin-top: -1rem;" >

                                                <option value="Username">الاسم</option>
                                                <option value="Code" selected>كود الطالب </option>
                                                <option value="phone" >رقم الهاتف</option>
                                                <option value="WhatsApp"> whatsapp </option>
                                                <option value="parentPhone"> رقم ولي الامر </option>
                                                
                                            </select>
                                        </div>
                                        <div class="col-md-4"> 
                                            <input type="text" class="mx-auto" name="searchInput" placeholder="بحث..">

                                        </div>
                                        <div class="col-md-4">  
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <button  class="primary" ><i class="fa-solid fa-magnifying-glass"></i></button>

                                                </div>
                                                <% if (isSearching) { %>

                                                <div class="col-md-1 d-flex justify-content-center align-items-center ">
                                                    <button><a href="/teacher/studentsRequests"  class="primary" style="margin-bottom: 0; margin-top: 0 !important; cursor: pointer;" ><i class="fa-solid fa-x"></i></a></button>
                                                </div>

                                                <% } %>
                                            </div>
                                          
                                        </div>
                                    </div>
                                
                                   

                               
                              </form>
                                <table id="myTable">
                                    <thead>
                                        <th style="padding: 10px;"># </th>
                                        <th style="padding-left: 20px;">Student Name</th>
                                        <th style="padding-left: 20px;">Code</th>
                                        <th style="padding-left: 20px;"> Created At</th>
                                        <th style="padding-left: 20px;"> Last Update</th>
                                        <th style="padding-left: 20px;"> Amount </th>
                                        <th style="padding-left: 20px;"> Amount Remaining</th>

                                        <th style="padding-left: 20px;"></th>
                                        <th style="padding-left: 20px;"></th>
                                    </thead>

                                    <tbody >
                                     <% if (studentsRequests && studentsRequests.length>0) { %>
                                        <% let counter = 1; %>
                                            <% studentsRequests.forEach(student => { %>
                                           
                                                <tr>
                                                    <td><%= counter %></td>
                                                    <td  style="line-height: 20px;"><span ><i class="fa-solid "></i></span><%= student.Username %></td>
                                                    <td id="code" ><%= student.Code %></td>
                                                    <td id="code" ><%= student.createdAt.toLocaleDateString() %></td>
                                                    <td id="code" ><%= student.updatedAt.toLocaleDateString() %></td>
                                                    <td id="code" ><%= student.balance %></td>
                                                    <td id="code" ><%= student.amountRemaining %></td>
                                           
                                                  

                                                    <td class="enter">
                                                      <button type="button" class="primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-id="<%= student._id %>" onclick="populateModal('<%= student._id %>')">
                                                      View Data<i class="fa-solid fa-pen-to-square me-3"></i>
                                                      </button>
                                                    </td>
                                                    

                                                     <td class="enter">
                                                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#exampleModal2" data-id="<%= student._id %>" onclick="getIdToDelete('<%= student._id %>')">
                                                            Delete Account<i class="fa-solid fa-trash me-3"></i>
                                                        </button>
                                                        <!-- <button ><a href="/teacher/studentsRequests/delete/<%=student._id  %>" class="btn btn-outline-danger" style="color: rgb(255, 255, 255); border: 2px solid rgb(211, 0, 0); border-radius: 30px; padding: .7rem;" >Delete Account<i class="fa-solid fa-trash me-3" ></i></a> </button>  -->
                                                    </td>
                                                </tr>

                                            <% counter++; %>

                                            <% }) %>
                                   
                                        <% } else { %>
                                            <tr style="text-align: center;">
                                                <td colspan="8">
                                                    <h1>لا يوجد .. يمكنك التأكد من البحث مجددا </h1>
                                                </td>
                                            </tr>
                                        <% } %>
                                    </tbody>
                                </table>

                            </div>
                            <div class="pagination justify-content-between">
                                        
                                <div>
                                    <% if (nextPage !== null) { %>
                                        <a href="/teacher/studentsRequests?Grade=<%= Grade %>&page=<%= nextPage %>" > <button class="paginationBtns">Next</button> </a>
                                    <% } %>
                                </div>

                                <div>
                                    <form action="/teacher/converStudentRequestsToExcel" method="post">
                                        <button class="paginationBtns">Convert To Excel</button> 
                                    </form>
                        
                                </div>
                                <div>
                                    <% if (previousPage !== null) { %>
                                        <a href="/teacher/studentsRequests?Grade=<%= Grade %>&page=<%= previousPage %>" >  <button class="paginationBtns"> Previous</button></a>
                                    <% } %>
                                </div>
                            </div>


                        </div>
                    </div>
                </main>
            </div>

            <!-------------------- END OF MAIN --------------------->
         
        </div>
    </div>



    <script src="/assest/bootstrap.bundle.min.js"></script>
    <script src="/assest/bootstrap.min.js"></script>

 <%- include("../partials/group.ejs") %>




<script>
    const spinner = document.getElementById('spinner');
    function populateModal(id){
      console.log(id)
      
      spinner.classList.remove('d-none');
      fetch(`/teacher/studentsRequests/${id}`)
        .then(response => response.json())
        .then(data => {
          console.log(data)
          document.getElementById('ModalUserName').value = data.Username;
          document.getElementById('ModalUserphone').value = data.phone;
          document.getElementById('ModalParentUserphone').value = data.parentPhone;
          document.getElementById('ModalUserAmount').value = data.balance;
          document.getElementById('amountRemaining').value = data.amountRemaining;
          document.getElementById('absences').value = data.absences;
          document.getElementById('GradeLevel').value = data.GradeLevel;
          document.getElementById('attendingType').value = data.attendingType;
          document.getElementById('bookTaken').value = data.bookTaken;
          document.getElementById('schoolName').value = data.schoolName;
          document.getElementById('StudentID').value = data._id;
          spinner.classList.add('d-none');
        })
        .catch(error => {
          console.error('Error fetching student data:', error)
          spinner.classList.add('d-none');
        });
    }



    const formModalDataUpdate = document.getElementById('formModalDataUpdate');
    formModalDataUpdate.addEventListener('submit', (e) => {
      e.preventDefault();
      spinner.classList.remove('d-none');
      const id = document.getElementById('StudentID').value;
      const data = {
        Username: document.getElementById('ModalUserName').value,
        phone: document.getElementById('ModalUserphone').value,
        parentPhone: document.getElementById('ModalParentUserphone').value,
        balance: document.getElementById('ModalUserAmount').value,
        amountRemaining: document.getElementById('amountRemaining').value,
        absences: document.getElementById('absences').value,
        GradeLevel: document.getElementById('GradeLevel').value,
        attendingType: document.getElementById('attendingType').value,
        bookTaken: document.getElementById('bookTaken').value,
        schoolName: document.getElementById('schoolName').value,

      };
      console.log(data)
      fetch(`/teacher/updateUserData/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
        .then(response => response.json())
        .then(data => {
          console.log('Success:', data);
          location.reload();
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    });

</script>


<script>
    const deleteForm = document.getElementById('deleteForm');
    function getIdToDelete(id){
        deleteForm.setAttribute('action', `/teacher/studentsRequests/delete/${id}`);
    }

    deleteForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      spinner.classList.remove('d-none');
    const response = await fetch(deleteForm.getAttribute('action'), {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
        const data = await response.json();
        console.log(data)

        if (response.ok) {
            location.reload();
        }else{
            console.log('error')
        }

    });


</script>

<!-- Advanced Search JavaScript -->
<script>
  document.getElementById('advancedSearchForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const studentCode = document.getElementById('studentCode').value.trim();
    
    if (!studentCode) {
      alert('الرجاء إدخال كود الطالب');
      return;
    }
    
    // Show loading spinner
    const spinner = document.getElementById('spinner');
    if (spinner) spinner.classList.remove('d-none');
    
    fetch(`/teacher/advancedStudentSearch/${studentCode}`)
      .then(response => {
        if (!response.ok) {
          throw new Error('Student not found');
        }
        return response.json();
      })
      .then(data => {
        // Hide spinner
        if (spinner) spinner.classList.add('d-none');
        
        // Populate student details
        document.getElementById('detailUsername').textContent = data.Username || 'غير متوفر';
        document.getElementById('detailCode').textContent = data.Code || 'غير متوفر';
        document.getElementById('detailPhone').textContent = data.phone || 'غير متوفر';
        document.getElementById('detailParentPhone').textContent = data.parentPhone || 'غير متوفر';
        document.getElementById('detailCenter').textContent = data.centerName || 'غير متوفر';
        document.getElementById('detailGrade').textContent = data.Grade || 'غير متوفر';
        document.getElementById('detailGradeType').textContent = data.gradeType || 'غير متوفر';
        document.getElementById('detailGroupTime').textContent = data.groupInfo ? data.groupInfo.displayText : data.groupTime || 'غير متوفر';
        document.getElementById('detailBalance').textContent = data.balance || '0';
        document.getElementById('detailAmountRemaining').textContent = data.amountRemaining || '0';
        document.getElementById('detailAbsences').textContent = data.absences || '0';
        document.getElementById('detailAttendingType').textContent = data.attendingType || 'غير متوفر';
        
        // Store student ID for edit/delete operations
        window.advancedStudentId = data._id;
        
        // Show the student details container
        document.getElementById('studentDetailsContainer').style.display = 'block';
      })
      .catch(error => {
        // Hide spinner
        if (spinner) spinner.classList.add('d-none');
        
        alert('لم يتم العثور على الطالب. الرجاء التحقق من الكود المدخل.');
        console.error('Error:', error);
        
        // Hide the student details container if visible
        document.getElementById('studentDetailsContainer').style.display = 'none';
      });
  });
  
  // Function to edit the student from advanced search
  function editAdvancedStudent() {
    if (!window.advancedStudentId) {
      alert('لم يتم العثور على بيانات الطالب');
      return;
    }
    
    // Use the existing modal to edit student
    populateModal(window.advancedStudentId);
    
    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('exampleModal'));
    modal.show();
  }
  
  // Function to delete the student from advanced search
  function deleteAdvancedStudent() {
    if (!window.advancedStudentId) {
      alert('لم يتم العثور على بيانات الطالب');
      return;
    }
    
    // Use the existing delete functionality
    getIdToDelete(window.advancedStudentId);
    
    // Show the delete confirmation modal
    const modal = new bootstrap.Modal(document.getElementById('exampleModal2'));
    modal.show();
  }
</script>

</body>


</html>